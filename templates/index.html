<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestor de Constancias</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 20px; border-radius: 10px; max-width: 450px; margin: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-extract { background: #0071bc; color: white; }
        .btn-pdf { background: #28a745; color: white; display: none; margin-top: 15px; }
        .curp-box { background: #e9ecef; padding: 10px; margin: 15px 0; display: none; border-radius: 5px; text-align: center; }
        #curp_val { font-weight: bold; color: #d63384; }
        .copy-btn { font-size: 12px; background: #6c757d; color: white; padding: 3px 8px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h3>Generador de Constancia</h3>
    
    <input type="text" id="rfc_in" placeholder="RFC">
    <input type="text" id="idcif_in" placeholder="idCIF">
    <button class="btn-extract" onclick="extraer()">1. EXTRAER DATOS DEL SAT</button>

    <div id="curp_box" class="curp-box">
        CURP: <span id="curp_val"></span>
        <span class="copy-btn" onclick="copiar()">COPIAR</span>
    </div>

    <form action="/generar_pdf" method="POST" id="form_final">
        <input type="hidden" name="rfc" id="f_rfc">
        <input type="hidden" name="idcif" id="f_idcif">
        <input type="hidden" name="curp" id="f_curp">
        
        <label>Verifica y completa:</label>
        <input type="text" name="nombre" id="f_nombre" placeholder="Nombre(s)" required>
        <input type="text" name="apellido_p" placeholder="Primer Apellido" required>
        <input type="text" name="apellido_m" placeholder="Segundo Apellido">
        
        <button type="submit" class="btn-pdf" id="btn_pdf">2. GENERAR PDF FINAL</button>
    </form>
</div>

<script>
async function extraer() {
    const rfc = document.getElementById('rfc_in').value;
    const idcif = document.getElementById('idcif_in').value;
    
    const fd = new FormData();
    fd.append('rfc', rfc);
    fd.append('idcif', idcif);

    const res = await fetch('/extraer_sat', { method: 'POST', body: fd });
    const data = await res.json();

    if(data.status === 'success') {
        document.getElementById('curp_val').innerText = data.curp;
        document.getElementById('f_curp').value = data.curp;
        document.getElementById('f_rfc').value = data.rfc;
        document.getElementById('f_idcif').value = idcif;
        document.getElementById('f_nombre').value = data.nombre;

        document.getElementById('curp_box').style.display = 'block';
        document.getElementById('btn_pdf').style.display = 'block';
    } else {
        alert("Error: " + data.message);
    }
}

function copiar() {
    const val = document.getElementById('curp_val').innerText;
    navigator.clipboard.writeText(val);
    alert("CURP Copiada al portapapeles");
}
</script>
</body>
</html>
