<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Extractor de Datos SAT</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding-top: 50px; }
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .curp-box { background: #e9ecef; padding: 10px; border-radius: 5px; margin-top: 15px; display: none; text-align: center; border: 1px dashed #6c757d; }
        #form-final { display: none; margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align: center;">Generador CSF</h2>
    
    <form id="extractForm">
        <input type="text" name="rfc" id="rfc_in" placeholder="RFC" required>
        <input type="text" name="idcif" id="idcif_in" placeholder="ID CIF" required>
        <button type="submit" id="btn-extract">1. EXTRAER DEL SAT</button>
    </form>

    <div id="curp-box" class="curp-box">
        <small>CURP Extra√≠da:</small><br>
        <strong id="curp-val"></strong>
    </div>

    <form id="form-final" action="/generar_pdf" method="POST">
        <input type="hidden" name="rfc" id="f_rfc">
        <input type="hidden" name="idcif" id="f_idcif">
        <input type="hidden" name="curp" id="f_curp">
        
        <label style="font-size: 12px;">Nombre(s):</label>
        <input type="text" name="nombre" id="f_nombre" required>
        
        <input type="text" name="apellido_p" placeholder="Apellido Paterno" required>
        <input type="text" name="apellido_m" placeholder="Apellido Materno">
        
        <button type="submit" style="background: #28a745;">2. GENERAR PDF</button>
    </form>
</div>

<script>
    document.getElementById('extractForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btn-extract');
        btn.disabled = true; btn.innerText = "Consultando...";

        const fd = new FormData(e.target);
        const res = await fetch('/extraer_sat', { method: 'POST', body: fd });
        const data = await res.json();

        if(data.status === 'success') {
            document.getElementById('curp-val').innerText = data.curp;
            document.getElementById('f_curp').value = data.curp;
            document.getElementById('f_rfc').value = data.rfc;
            document.getElementById('f_idcif').value = document.getElementById('idcif_in').value;
            document.getElementById('f_nombre').value = data.nombre;

            document.getElementById('curp-box').style.display = 'block';
            document.getElementById('form-final').style.display = 'block';
        } else {
            alert("Error: " + data.message);
        }
        btn.disabled = false; btn.innerText = "1. EXTRAER DEL SAT";
    };
</script>

</body>
</html>
