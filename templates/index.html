<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador CSF Oficial</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 10px; max-width: 450px; margin: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: #007bff; color: white; }
        .btn-green { background: #28a745; color: white; margin-top: 15px; display: none; }
        #curp-info { display: none; background: #fff3cd; padding: 15px; border-radius: 5px; margin-top: 15px; text-align: center; }
        #manual-fields { display: none; }
    </style>
</head>
<body>
    <div class="card">
        <h2>Extractor SAT</h2>
        <input type="text" id="rfc" placeholder="RFC">
        <input type="text" id="idcif" placeholder="ID CIF">
        <button class="btn-blue" onclick="extraer()">1. EXTRAER DATOS</button>

        <div id="curp-info">
            <small>CURP Extra√≠da:</small><br>
            <strong id="curp-text"></strong>
        </div>

        <form id="manual-fields" action="/generar_pdf" method="POST">
            <input type="hidden" name="rfc" id="f_rfc">
            <input type="hidden" name="idcif" id="f_idcif">
            <input type="hidden" name="curp" id="f_curp">
            
            <label>Confirmar Nombre(s):</label>
            <input type="text" name="nombre" id="f_nombre" required>
            <input type="text" name="apellido_p" placeholder="Apellido Paterno" required>
            <input type="text" name="apellido_m" placeholder="Apellido Materno">
            
            <button type="submit" class="btn-green" id="btn-gen">2. GENERAR PDF FINAL</button>
        </form>
    </div>

    <script>
        async function extraer() {
            const rfc = document.getElementById('rfc').value;
            const idcif = document.getElementById('idcif').value;
            const fd = new FormData();
            fd.append('rfc', rfc);
            fd.append('idcif', idcif);

            const res = await fetch('/extraer_sat', { method: 'POST', body: fd });
            const data = await res.json();

            if(data.status === 'success') {
                document.getElementById('curp-text').innerText = data.curp;
                document.getElementById('f_curp').value = data.curp;
                document.getElementById('f_rfc').value = data.rfc;
                document.getElementById('f_idcif').value = idcif;
                document.getElementById('f_nombre').value = data.nombre;

                document.getElementById('curp-info').style.display = 'block';
                document.getElementById('manual-fields').style.display = 'block';
                document.getElementById('btn-gen').style.display = 'block';
            } else { alert("Error: " + data.message); }
        }
    </script>
</body>
</html>
